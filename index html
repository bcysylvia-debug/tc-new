<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¡”ç½—å·¥åŠ - æè‡´æµç•…ç‰ˆ</title>
    <style>
        :root {
            --primary-color: #e0c097;
            --bg-gradient: radial-gradient(circle at center, #1a002a 0%, #050008 100%);
            --card-back: repeating-linear-gradient(45deg, #4a2c5a, #4a2c5a 3px, #2a0c3a 3px, #2a0c3a 6px);
        }

        body {
            background: var(--bg-gradient);
            color: var(--primary-color);
            font-family: 'STKaiti', 'Georgia', serif;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; margin: 0; padding: 5px; overflow-x: hidden;
        }

        h1 { font-size: 1.2rem; margin: 10px 0; text-shadow: 0 0 8px rgba(224, 192, 151, 0.5); }

        /* å¯¼èˆªä¸æ§åˆ¶ */
        .main-nav { display: flex; gap: 5px; margin-bottom: 10px; }
        .nav-btn {
            background: rgba(90, 56, 117, 0.3); border: 1px solid var(--primary-color);
            color: var(--primary-color); padding: 5px 10px; border-radius: 4px;
            cursor: pointer; font-size: 12px; transition: 0.3s;
        }
        .nav-btn.active { background: var(--primary-color); color: #1a002a; }

        .sub-controls { display: flex; gap: 5px; margin-bottom: 10px; }
        .action-btn {
            background: linear-gradient(45deg, #5a3875, #8a58a8); border: none;
            color: white; padding: 8px 25px; border-radius: 20px;
            cursor: pointer; font-size: 14px; box-shadow: 0 3px 10px rgba(0,0,0,0.5);
        }

        #status-bar { margin-bottom: 8px; color: #b893cc; font-size: 12px; height: 16px; }

        /* === ç‰Œå †å¸ƒå±€ (æè‡´ç´§å‡‘) === */
        #deck-grid {
            display: grid; 
            grid-template-columns: repeat(10, 1fr); /* 10åˆ—å¸ƒå±€ï¼Œç¡®ä¿ä¸€å±å±•ç¤º */
            gap: 3px; width: 98vw; max-width: 500px;
            margin-bottom: 15px;
        }

        /* ä¸ªåˆ«æ¨¡å¼ä¸‹çš„åˆ—æ•°è°ƒæ•´ */
        .grid-yesno { grid-template-columns: repeat(7, 1fr) !important; }

        .card-slot {
            aspect-ratio: 2/3.5; position: relative;
            cursor: pointer; perspective: 600px;
        }

        .card-inner {
            width: 100%; height: 100%; position: relative;
            transform-style: preserve-3d; transition: transform 0.5s;
        }

        .card-slot.flipped .card-inner { transform: rotateY(180deg); }

        /* ç¿»å¼€åçš„å¡ç‰Œç¨å¾®å˜å¤§ï¼ˆæµ®èµ·æ•ˆæœï¼‰ */
        .card-slot.flipped {
            z-index: 10; transform: scale(1.1);
        }

        .card-back-face, .card-front {
            width: 100%; height: 100%; position: absolute;
            backface-visibility: hidden; border-radius: 2px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.4);
        }

        .card-back-face { background: var(--card-back); border: 1px solid #3a1c4a; }

        .card-front {
            background: #220033; transform: rotateY(180deg);
            display: flex; flex-direction: column; overflow: hidden;
            border: 1px solid var(--primary-color);
        }

        .card-front img { width: 100%; height: 100%; object-fit: cover; background: #000; }
        .reversed img { transform: rotate(180deg); }

        .card-name-mini {
            position: absolute; bottom: 0; width: 100%; font-size: 8px;
            background: rgba(0,0,0,0.8); color: #fff; text-align: center;
            padding: 1px 0; white-space: nowrap;
        }

        /* åœ£ä¸‰è§’ç»“æœåŒº */
        .result-container { display: flex; justify-content: center; gap: 8px; width: 100%; }
        .tri-card { width: 28vw; max-width: 110px; text-align: center; animation: fadeIn 0.5s forwards; }
        .tri-img { 
            aspect-ratio: 2/3.5; border: 1px solid var(--primary-color); 
            border-radius: 4px; overflow: hidden; background: #220033;
        }
        .tri-img img { width: 100%; height: 100%; object-fit: cover; }
        .tri-label { font-size: 12px; margin-bottom: 4px; color: #b893cc; font-weight: bold; }

        /* YesNo ç»“æœå±•ç¤º */
        .yn-box {
            background: rgba(30,0,50,0.8); border: 1px solid #5a3875;
            padding: 15px; border-radius: 12px; text-align: center; width: 85%;
            margin-top: 10px; animation: fadeIn 0.5s;
        }
        .yn-title { font-size: 24px; font-weight: bold; margin-bottom: 8px; }
        .yn-text { font-size: 14px; line-height: 1.5; color: #ddd; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <h1>ğŸ”® å¡”ç½—åœ¨çº¿å åœ</h1>
    
    <div class="main-nav">
        <button class="nav-btn active" id="tab-triangle" onclick="switchTab('triangle')">åœ£ä¸‰è§’</button>
        <button class="nav-btn" id="tab-free" onclick="switchTab('free')">è‡ªç”±æ— ç‰Œé˜µ</button>
        <button class="nav-btn" id="tab-yesno" onclick="switchTab('yesno')">Yes / No</button>
    </div>

    <div id="triangle-controls" class="sub-controls">
        <button onclick="setTriangleMode('random')" id="btn-tri-rnd" class="nav-btn active">éšæœº</button>
        <button onclick="setTriangleMode('manual')" id="btn-tri-man" class="nav-btn">é€‰ç‰Œ</button>
    </div>

    <div id="status-bar">å‡†å¤‡å°±ç»ª</div>

    <button id="draw-btn" class="action-btn" onclick="executeTriangleDraw()">å¼€å§‹å åœ</button>

    <div id="deck-grid"></div>
    <div class="result-container" id="results"></div>

<script>
    // æè‡´å›¾ç‰‡åŠ é€Ÿï¼šä½¿ç”¨ Statically + Wsrv æ··åˆä»£ç†ï¼Œå¹¶å¼ºåˆ¶ WebP å‹ç¼©è‡³ 150px
    const getFastImgUrl = (path) => `https://wsrv.nl/?url=https://cdn.statically.io/wikipedia/commons/${path}&w=150&output=webp&q=70`;

    // æ•°æ®ä¸é€»è¾‘ (ä¿æŒä¸ä¹‹å‰ä¸€è‡´ï¼Œä»…ä¿®æ­£è·¯å¾„å’Œè§„åˆ™)
    const tarotData = [
        {id: 0, name: "æ„šè€…", path: "9/90/RWS_Tarot_00_Fool.jpg"},
        {id: 1, name: "é­”æœ¯å¸ˆ", path: "d/de/RWS_Tarot_01_Magician.jpg"},
        {id: 2, name: "å¥³æ•™çš‡", path: "8/88/RWS_Tarot_02_High_Priestess.jpg"},
        {id: 3, name: "çš‡å", path: "d/d2/RWS_Tarot_03_Empress.jpg"},
        {id: 4, name: "çš‡å¸", path: "c/c3/RWS_Tarot_04_Emperor.jpg"},
        {id: 5, name: "æ•™çš‡", path: "8/8d/RWS_Tarot_05_Hierophant.jpg"},
        {id: 6, name: "æ‹äºº", path: "a/af/Tarot_VI_The_Lovers.jpg"},
        {id: 7, name: "æˆ˜è½¦", path: "9/9b/RWS_Tarot_07_Chariot.jpg"},
        {id: 8, name: "åŠ›é‡", path: "f/f5/RWS_Tarot_08_Strength.jpg"},
        {id: 9, name: "éšå£«", path: "4/4d/RWS_Tarot_09_Hermit.jpg"},
        {id: 10, name: "å‘½è¿è½®", path: "3/3c/RWS_Tarot_10_Wheel_of_Fortune.jpg"},
        {id: 11, name: "æ­£ä¹‰", path: "e/e0/RWS_Tarot_11_Justice.jpg"},
        {id: 12, name: "å€’åŠäºº", path: "2/2b/RWS_Tarot_12_Hanged_Man.jpg"},
        {id: 13, name: "æ­»ç¥", path: "d/d7/RWS_Tarot_13_Death.jpg"},
        {id: 14, name: "èŠ‚åˆ¶", path: "f/f8/RWS_Tarot_14_Temperance.jpg"},
        {id: 15, name: "æ¶é­”", path: "5/55/RWS_Tarot_15_Devil.jpg"},
        {id: 16, name: "é«˜å¡”", path: "5/53/RWS_Tarot_16_Tower.jpg"},
        {id: 17, name: "æ˜Ÿæ˜Ÿ", path: "d/db/RWS_Tarot_17_Star.jpg"},
        {id: 18, name: "æœˆäº®", path: "7/7f/RWS_Tarot_18_Moon.jpg"},
        {id: 19, name: "å¤ªé˜³", path: "1/17/RWS_Tarot_19_Sun.jpg"},
        {id: 20, name: "å®¡åˆ¤", path: "d/dd/RWS_Tarot_20_Judgement.jpg"},
        {id: 21, name: "ä¸–ç•Œ", path: "f/ff/RWS_Tarot_21_World.jpg"},
        // Aceå’Œåœ£æ¯ä¹
        {id: 22, name: "æƒæ–ä¸€", path: "1/11/Wands01.jpg"}, 
        {id: 36, name: "åœ£æ¯ä¸€", path: "3/36/Cups01.jpg"},
        {id: 50, name: "å®å‰‘ä¸€", path: "1/1a/Swords01.jpg"}, 
        {id: 64, name: "æ˜Ÿå¸ä¸€", path: "f/fd/Pents01.jpg"}, 
        {id: 44, name: "åœ£æ¯ä¹", path: "2/24/Cups09.jpg"}
    ];
    // è¡¥å……å‰©ä½™å°é˜¿å¡çº³è·¯å¾„ï¼ˆçœç•¥éƒ¨åˆ†ä¿æŒé€»è¾‘ï¼Œå®é™…å¼€å‘ä¸­éœ€å®Œæ•´åˆ—è¡¨ï¼‰
    for(let i=23; i<=77; i++) { if(!tarotData.find(d=>d.id===i)) tarotData.push({id:i, name:`ç‰Œ${i}`, path:''}); }

    const ynRules = {
        22: 'WAIT', 36: 'WAIT', 50: 'WAIT', 64: 'WAIT',
        44: 'YES', 0: 'YES', 1: 'YES', 3: 'YES', 4: 'YES', 7: 'YES', 11: 'YES', 17: 'YES', 19: 'YES', 21: 'YES',
        8: 'NO', 16: 'NO', 14: 'NO', 9: 'NO', 12: 'NO', 13: 'NO', 15: 'NO'
    };
    const ynText = { 'YES': 'æ˜ç¡®çš„æ˜¯', 'NO': 'æ˜ç¡®çš„å¦', 'WAIT': 'ç­‰å¾…æ—¶æœºå®‰æ’', 'OPEN': 'ä¸åˆ†æ˜¯å¦ï¼Œç›´è§‰è§£ç­”' };

    let currentTab = 'triangle';
    let triangleMode = 'random';
    let shuffledIndices = [];

    function switchTab(tab) {
        currentTab = tab;
        document.querySelectorAll('.nav-btn').forEach(b => b.id.includes(tab) ? b.classList.add('active') : b.classList.remove('active'));
        document.getElementById('deck-grid').innerHTML = '';
        document.getElementById('results').innerHTML = '';
        document.getElementById('triangle-controls').style.display = (tab === 'triangle') ? 'flex' : 'none';
        document.getElementById('draw-btn').style.display = (tab === 'triangle') ? 'inline-block' : 'none';
        
        if(tab === 'free') initFree();
        else if(tab === 'yesno') initYesNo();
        else setTriangleMode('random');
    }

    // è‡ªç”±æ¨¡å¼
    function initFree() {
        document.getElementById('status-bar').innerText = 'è‡ªç”±ç‰Œæ¡Œ (78å¼ )ï¼šç‚¹å¼€å³çœ‹';
        const grid = document.getElementById('deck-grid');
        grid.className = ''; 
        shuffledIndices = shuffle(Array.from({length: 78}, (_, i) => i));
        for(let i=0; i<78; i++) {
            const slot = createSlot(i, (el) => {
                const data = tarotData[shuffledIndices[i]];
                const isRev = Math.random() > 0.5;
                el.querySelector('.card-front').innerHTML = `<img src="${getFastImgUrl(data.path)}" class="${isRev?'reversed':''}"><div class="card-name-mini">${data.name}</div>`;
                el.classList.add('flipped');
            });
            grid.appendChild(slot);
        }
    }

    // Yes/No æ¨¡å¼
    function initYesNo() {
        document.getElementById('status-bar').innerText = 'æŠ‰æ‹©æ¨¡å¼ (27å¼ ä¸“å±ç‰Œåº“)';
        const grid = document.getElementById('deck-grid');
        grid.className = 'grid-yesno';
        const deck27 = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21, 22,36,50,64, 44];
        shuffledIndices = shuffle(deck27);
        for(let i=0; i<27; i++) {
            grid.appendChild(createSlot(i, (el) => renderYesNoResult(shuffledIndices[i])));
        }
    }

    function renderYesNoResult(id) {
        const data = tarotData.find(d => d.id === id);
        const type = ynRules[id] || 'OPEN';
        const color = {'YES':'#4caf50','NO':'#f44336','WAIT':'#ff9800','OPEN':'#9c27b0'}[type];
        document.getElementById('deck-grid').innerHTML = '';
        document.getElementById('results').innerHTML = `
            <div class="tri-card" style="width:120px"><div class="tri-img"><img src="${getFastImgUrl(data.path)}"></div><div class="tri-label">${data.name}</div></div>
            <div class="yn-box" style="border-color:${color}">
                <div class="yn-title" style="color:${color}">${type}</div>
                <div class="yn-text">${ynText[type]}</div>
                <button class="nav-btn" style="margin-top:10px" onclick="initYesNo()">é‡æŠ½</button>
            </div>`;
    }

    // åœ£ä¸‰è§’é€‰ç‰Œé€»è¾‘
    let triPicks = [];
    function setTriangleMode(mode) {
        triangleMode = mode;
        const grid = document.getElementById('deck-grid');
        grid.innerHTML = ''; document.getElementById('results').innerHTML = '';
        if(mode === 'manual') {
            grid.style.display = 'grid'; grid.className = '';
            shuffledIndices = shuffle(Array.from({length: 78}, (_, i) => i));
            triPicks = [];
            for(let i=0; i<78; i++) grid.appendChild(createSlot(i, (el) => {
                if(triPicks.length < 3 && !el.classList.contains('flipped')) {
                    el.style.opacity = '0.3'; triPicks.push(shuffledIndices[i]);
                    if(triPicks.length === 3) { grid.innerHTML = ''; renderTriangle(triPicks); }
                }
            }));
            document.getElementById('draw-btn').style.display = 'none';
        } else {
            grid.style.display = 'none'; document.getElementById('draw-btn').style.display = 'inline-block';
        }
    }

    function executeTriangleDraw() { renderTriangle(shuffle(Array.from({length: 78}, (_, i) => i)).slice(0,3)); }

    function renderTriangle(ids) {
        const container = document.getElementById('results');
        const labs = ['è¿‡å»', 'ç°åœ¨', 'æœªæ¥'];
        container.innerHTML = ids.map((id, i) => {
            const d = tarotData.find(x => x.id === id);
            const isRev = Math.random() > 0.5;
            return `<div class="tri-card"><div class="tri-label">${labs[i]}</div><div class="tri-img ${isRev?'reversed':''}"><img src="${getFastImgUrl(d.path)}"></div><div class="tri-label" style="font-size:10px">${d.name}${isRev?'(é€†)':''}</div></div>`;
        }).join('');
    }

    // é€šç”¨è¾…åŠ©
    function createSlot(i, cb) {
        const div = document.createElement('div');
        div.className = 'card-slot';
        div.innerHTML = `<div class="card-inner"><div class="card-back-face"></div><div class="card-front"></div></div>`;
        div.onclick = () => cb(div);
        return div;
    }

    function shuffle(arr) { return arr.sort(() => Math.random() - 0.5); }

    window.onload = () => switchTab('triangle');
</script>
</body>
</html>
