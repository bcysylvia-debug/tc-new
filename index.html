<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å¥èº«è¯¾è§„åˆ’ (16-36èŠ‚)</title>
    <style>
        :root {
            --bg: #f8f9fa;
            --planned-bg: #e3f2fd;
            --planned-text: #2196F3;
            --done-bg: #e8f5e9;
            --done-text: #4CAF50;
            --today-border: #ff5722;
        }
        body { font-family: sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 20px; color: #333; }
        .stats { background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 15px; width: 100%; max-width: 600px; display: flex; justify-content: space-around; font-size: 0.9em; }
        
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; width: 100%; max-width: 600px; }
        .weekday-header { font-weight: bold; text-align: center; padding: 5px 0; font-size: 0.8em; color: #666; }
        .month-divider { grid-column: 1 / span 7; padding: 8px; font-weight: bold; background: #eee; font-size: 0.85em; margin-top: 10px; border-radius: 4px; }
        
        .day { background: white; border-radius: 5px; padding: 5px; min-height: 55px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); cursor: pointer; display: flex; flex-direction: column; border: 1.5px solid transparent; position: relative; }
        .day:hover { background: #f0f0f0; }
        .day.today { border-color: var(--today-border); }
        .day.today::after { content: "ä»Š"; position: absolute; top: 2px; right: 2px; font-size: 10px; background: var(--today-border); color: white; padding: 1px 3px; border-radius: 2px; }
        
        .day[data-status="planned"] { background-color: var(--planned-bg); border-color: var(--planned-text); }
        .day[data-status="done"] { background-color: var(--done-bg); border-color: var(--done-text); }
        
        .date-num { font-size: 0.85em; font-weight: bold; }
        .class-info { font-size: 0.75em; margin-top: auto; text-align: right; font-weight: bold; }
        [data-status="planned"] .class-info { color: var(--planned-text); }
        [data-status="done"] .class-info { color: var(--done-text); }

        .legend { margin-top: 15px; font-size: 0.8em; color: #666; display: flex; gap: 10px; }
        .dot { width: 10px; height: 10px; display: inline-block; border-radius: 2px; }
    </style>
</head>
<body>

    <h3 style="margin-bottom:10px;">ğŸ‹ï¸ å¥èº«è¯¾è®°å½• (ç¬¬16-36èŠ‚)</h3>

    <div class="stats">
        <div>å·²å®Œ: <strong id="done-display">0</strong>/36</div>
        <div>è¿˜éœ€å®‰æ’: <strong id="need-display">0</strong></div>
        <div>ç›®æ ‡: <strong>3æœˆ31æ—¥</strong></div>
    </div>

    <div class="calendar-grid" id="calendar">
        <div class="weekday-header">æ—¥</div><div class="weekday-header">ä¸€</div>
        <div class="weekday-header">äºŒ</div><div class="weekday-header">ä¸‰</div>
        <div class="weekday-header">å››</div><div class="weekday-header">äº”</div>
        <div class="weekday-header">å…­</div>
    </div>

    <div class="legend">
        <span><i class="dot" style="background:var(--done-text)"></i> å·²å®Œ</span>
        <span><i class="dot" style="background:var(--planned-text)"></i> è®¡åˆ’</span>
        <span><i class="dot" style="background:var(--today-border)"></i> ä»Šå¤©</span>
    </div>

<script>
    const totalGoal = 36;
    const baseCount = 15; // ä¹‹å‰å·²å®Œæˆ15èŠ‚
    const start = new Date(2026, 0, 1);
    const end = new Date(2026, 2, 31);
    
    // ä¿®æ­£æ—¥æœŸè·å–ï¼šç¡®ä¿è·å–æœ¬åœ°æ—¶é—´çš„ YYYY-MM-DD
    function getLocalDateStr(date) {
        let y = date.getFullYear();
        let m = String(date.getMonth() + 1).padStart(2, '0');
        let d = String(date.getDate()).padStart(2, '0');
        return `${y}-${m}-${d}`;
    }

    const todayStr = getLocalDateStr(new Date());
    let schedule = JSON.parse(localStorage.getItem('gym_v4')) || {};
    
    // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¿è¡Œï¼Œé»˜è®¤ä»Šå¤©ä¸Šå®Œäº†ç¬¬16èŠ‚
    if (Object.keys(schedule).length === 0) {
        schedule[todayStr] = 'done';
    }

    function render() {
        const container = document.getElementById('calendar');
        // ä¿ç•™æ˜ŸæœŸè¡¨å¤´
        const headers = Array.from(container.querySelectorAll('.weekday-header'));
        container.innerHTML = '';
        headers.forEach(h => container.appendChild(h));

        // æ’åºå·²é€‰æ—¥æœŸç”¨äºç¼–å·
        const sortedActiveDates = Object.keys(schedule).sort();
        const dateToNum = {};
        sortedActiveDates.forEach((d, i) => {
            dateToNum[d] = baseCount + i + 1;
        });

        let cur = new Date(start);
        let curMonth = -1;

        while (cur <= end) {
            const dateStr = getLocalDateStr(cur);
            
            // æœˆä»½æ ‡é¢˜
            if (cur.getMonth() !== curMonth) {
                curMonth = cur.getMonth();
                const div = document.createElement('div');
                div.className = 'month-divider';
                div.innerText = `${cur.getFullYear()}å¹´ ${curMonth + 1}æœˆ`;
                container.appendChild(div);
                // è¡¥é½æœˆåˆç©ºç™½
                for(let i=0; i<cur.getDay(); i++) container.appendChild(document.createElement('div'));
            }

            const dayEl = document.createElement('div');
            dayEl.className = 'day';
            if (dateStr === todayStr) dayEl.classList.add('today');
            
            const status = schedule[dateStr];
            if (status) dayEl.dataset.status = status;

            dayEl.innerHTML = `
                <div class="date-num">${cur.getDate()}</div>
                <div class="class-info">${status ? 'ç¬¬'+dateToNum[dateStr]+'èŠ‚' : ''}</div>
            `;

            dayEl.onclick = () => {
                if (!status) schedule[dateStr] = 'planned';
                else if (status === 'planned') schedule[dateStr] = 'done';
                else delete schedule[dateStr];
                localStorage.setItem('gym_v4', JSON.stringify(schedule));
                render();
            };

            container.appendChild(dayEl);
            cur.setDate(cur.getDate() + 1);
        }

        // æ›´æ–°ç»Ÿè®¡
        const doneCount = baseCount + Object.values(schedule).filter(s => s === 'done').length;
        document.getElementById('done-display').innerText = doneCount;
        const totalPlanned = baseCount + sortedActiveDates.length;
        document.getElementById('need-display').innerText = Math.max(0, totalGoal - totalPlanned);
    }

    render();
</script>
</body>
</html>
