<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥èº«è§„åˆ’ (æœ€ç»ˆå›ºå®šç‰ˆ)</title>
    <style>
        :root {
            --bg: #f8f9fa;
            --planned-bg: #e3f2fd;
            --planned-text: #2196F3;
            --done-bg: #e8f5e9;
            --done-text: #4CAF50;
            --today-border: #ff5722;
        }
        body { font-family: -apple-system, sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 20px; color: #333; user-select: none; }
        
        /* æ ‡é¢˜ä¸ä¿å­˜æç¤º */
        .header-area { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
        h3 { margin: 0; }
        .save-msg { font-size: 0.8em; color: var(--done-text); opacity: 0; transition: opacity 0.5s; font-weight: bold; }
        .save-msg.show { opacity: 1; }

        /* ç»Ÿè®¡æ  */
        .stats { background: white; padding: 12px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 15px; width: 100%; max-width: 600px; display: flex; justify-content: space-between; font-size: 0.9em; box-sizing: border-box; }
        .stats div { text-align: center; flex: 1; }
        .stats strong { display: block; font-size: 1.2em; margin-bottom: 2px; }
        
        /* æ—¥å†ç½‘æ ¼ */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; width: 100%; max-width: 600px; }
        .weekday-header { font-weight: bold; text-align: center; padding: 5px 0; font-size: 0.75em; color: #999; }
        .month-divider { grid-column: 1 / span 7; padding: 6px; font-weight: bold; background: #eee; font-size: 0.8em; margin-top: 8px; border-radius: 4px; color: #555; }
        
        /* æ—¥æœŸæ ¼å­ */
        .day { 
            background: white; border-radius: 4px; padding: 4px; min-height: 50px; 
            box-shadow: 0 1px 2px rgba(0,0,0,0.05); cursor: pointer; 
            display: flex; flex-direction: column; border: 1.5px solid transparent; 
            position: relative; transition: background 0.1s;
        }
        .day:hover { background: #f0f0f0; }
        
        /* ä»Šå¤©çš„é«˜äº® */
        .day.today { border-color: var(--today-border); }
        .day.today::after { content: "ä»Š"; position: absolute; top: 2px; right: 2px; font-size: 9px; background: var(--today-border); color: white; padding: 1px 3px; border-radius: 2px; }
        
        /* çŠ¶æ€é¢œè‰² */
        .day[data-status="planned"] { background-color: var(--planned-bg); border-color: var(--planned-text); }
        .day[data-status="done"] { background-color: var(--done-bg); border-color: var(--done-text); }
        
        .date-num { font-size: 0.85em; font-weight: bold; color: #444; }
        .class-info { font-size: 0.7em; margin-top: auto; text-align: right; font-weight: 800; }
        
        [data-status="planned"] .class-info { color: var(--planned-text); }
        [data-status="done"] .class-info { color: var(--done-text); }

        .legend { margin-top: 15px; font-size: 0.75em; color: #888; display: flex; gap: 15px; }
        .dot { width: 8px; height: 8px; display: inline-block; border-radius: 50%; margin-right: 4px; }
    </style>
</head>
<body>

    <div class="header-area">
        <h3>ğŸ’ª å¥èº«å†²åˆº (ç¬¬21-36èŠ‚)</h3>
        <span id="save-msg" class="save-msg">âœ“ å·²ä¿å­˜</span>
    </div>

    <div class="stats">
        <div>
            <strong id="done-display" style="color:var(--done-text)">0</strong>
            <span style="color:#888">å·²å®Œæˆ (ç›®æ ‡36)</span>
        </div>
        <div>
            <strong id="remaining-display" style="color:#ff9800">0</strong>
            <span style="color:#888">å‰©ä½™éœ€å®‰æ’</span>
        </div>
    </div>

    <div class="calendar-grid" id="calendar">
        <div class="weekday-header">æ—¥</div><div class="weekday-header">ä¸€</div>
        <div class="weekday-header">äºŒ</div><div class="weekday-header">ä¸‰</div>
        <div class="weekday-header">å››</div><div class="weekday-header">äº”</div>
        <div class="weekday-header">å…­</div>
    </div>

    <div class="legend">
        <span><i class="dot" style="background:var(--done-text)"></i>å·²å®Œæˆ</span>
        <span><i class="dot" style="background:var(--planned-text)"></i>è®¡åˆ’ä¸­</span>
        <span><i class="dot" style="background:var(--today-border)"></i>ä»Šå¤©</span>
    </div>

<script>
    // --- æ ¸å¿ƒé…ç½® ---
    const totalGoal = 36;
    const baseCount = 20; // 1.15æ—¥ä¹‹å‰é»˜è®¤å®Œæˆäº†20èŠ‚
    const start = new Date(2026, 0, 1); // 1æœˆ1æ—¥
    const end = new Date(2026, 2, 31);  // 3æœˆ31æ—¥
    
    // è·å–æœ¬åœ°æ—¥æœŸå­—ç¬¦ä¸²
    function getLocalDateStr(date) {
        let y = date.getFullYear();
        let m = String(date.getMonth() + 1).padStart(2, '0');
        let d = String(date.getDate()).padStart(2, '0');
        return `${y}-${m}-${d}`;
    }

    const todayStr = getLocalDateStr(new Date());
    
    // ã€é‡è¦ã€‘ä½¿ç”¨å›ºå®šçš„å­˜å‚¨åï¼Œä¸å†éšæ„æ›´æ”¹
    const STORAGE_KEY = 'gym_calendar_final_fixed';
    
    let schedule = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
    
    // å¦‚æœæ˜¯å…¨æ–°æ‰“å¼€ï¼ˆä¸”ä»Šå¤©æœªè¢«æ ‡è®°ï¼‰ï¼Œåˆ™åˆå§‹åŒ–ä»Šå¤©ä¸ºå®ŒæˆçŠ¶æ€
    if (Object.keys(schedule).length === 0) {
        schedule[todayStr] = 'done';
        localStorage.setItem(STORAGE_KEY, JSON.stringify(schedule));
    }

    // æ˜¾ç¤ºä¿å­˜æç¤º
    function showSaveMsg() {
        const msg = document.getElementById('save-msg');
        msg.classList.add('show');
        setTimeout(() => msg.classList.remove('show'), 1000);
    }

    function render() {
        const container = document.getElementById('calendar');
        const headers = Array.from(container.querySelectorAll('.weekday-header'));
        container.innerHTML = '';
        headers.forEach(h => container.appendChild(h));

        // æ’åºå¹¶è®¡ç®—ç¼–å·
        const sortedDates = Object.keys(schedule).sort();
        const dateToNum = {};
        sortedDates.forEach((d, i) => {
            dateToNum[d] = baseCount + i + 1;
        });

        let cur = new Date(start);
        let curMonth = -1;

        while (cur <= end) {
            const dateStr = getLocalDateStr(cur);
            
            // æœˆä»½åˆ†å‰²
            if (cur.getMonth() !== curMonth) {
                curMonth = cur.getMonth();
                const div = document.createElement('div');
                div.className = 'month-divider';
                div.innerText = `${cur.getFullYear()}å¹´ ${curMonth + 1}æœˆ`;
                container.appendChild(div);
                for(let i=0; i<cur.getDay(); i++) container.appendChild(document.createElement('div'));
            }

            const dayEl = document.createElement('div');
            dayEl.className = 'day';
            if (dateStr === todayStr) dayEl.classList.add('today');
            
            const status = schedule[dateStr];
            if (status) dayEl.dataset.status = status;

            const numText = status ? `ç¬¬${dateToNum[dateStr]}èŠ‚` : '';
            dayEl.innerHTML = `
                <div class="date-num">${cur.getDate()}</div>
                <div class="class-info">${numText}</div>
            `;

            dayEl.onclick = () => {
                if (!status) schedule[dateStr] = 'planned';
                else if (status === 'planned') schedule[dateStr] = 'done';
                else delete schedule[dateStr];
                
                // ç«‹å³ä¿å­˜åˆ°æµè§ˆå™¨
                localStorage.setItem(STORAGE_KEY, JSON.stringify(schedule));
                showSaveMsg(); // æç¤ºå·²ä¿å­˜
                render();
            };

            container.appendChild(dayEl);
            cur.setDate(cur.getDate() + 1);
        }

        // æ›´æ–°ç»Ÿè®¡
        const doneOnScreen = Object.values(schedule).filter(s => s === 'done').length;
        const totalDone = baseCount + doneOnScreen;
        const totalScheduled = baseCount + sortedDates.length;
        
        document.getElementById('done-display').innerText = `${totalDone}/${totalGoal}`;
        document.getElementById('remaining-display').innerText = Math.max(0, totalGoal - totalScheduled);
    }

    render();
</script>
</body>
</html>
