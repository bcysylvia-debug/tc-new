<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å¥èº«è§„åˆ’ (ç¬¬21-36èŠ‚)</title>
    <style>
        :root {
            --bg: #f8f9fa;
            --planned-bg: #e3f2fd;
            --planned-text: #2196F3;
            --done-bg: #e8f5e9;
            --done-text: #4CAF50;
            --today-border: #ff5722;
        }
        body { font-family: sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 20px; color: #333; }
        
        /* é¡¶éƒ¨ç»Ÿè®¡å¡ç‰‡ - ç´§å‡‘å‹ */
        .stats { background: white; padding: 12px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 15px; width: 100%; max-width: 600px; display: flex; justify-content: space-between; font-size: 0.9em; box-sizing: border-box; }
        .stats div { text-align: center; flex: 1; }
        .stats strong { display: block; font-size: 1.2em; margin-bottom: 2px; }
        
        /* æ—¥å†ç½‘æ ¼ */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; width: 100%; max-width: 600px; }
        
        .weekday-header { font-weight: bold; text-align: center; padding: 5px 0; font-size: 0.75em; color: #999; }
        
        .month-divider { grid-column: 1 / span 7; padding: 6px; font-weight: bold; background: #eee; font-size: 0.8em; margin-top: 8px; border-radius: 4px; color: #555; }
        
        .day { 
            background: white; border-radius: 4px; padding: 4px; min-height: 50px; 
            box-shadow: 0 1px 2px rgba(0,0,0,0.05); cursor: pointer; 
            display: flex; flex-direction: column; border: 1.5px solid transparent; 
            position: relative; transition: all 0.1s;
        }
        .day:hover { background: #f0f0f0; transform: translateY(-1px); }
        
        /* ä»Šå¤©çš„é«˜äº®æ ·å¼ */
        .day.today { border-color: var(--today-border); }
        .day.today::after { content: "ä»Š"; position: absolute; top: 2px; right: 2px; font-size: 9px; background: var(--today-border); color: white; padding: 1px 3px; border-radius: 2px; }
        
        /* çŠ¶æ€é¢œè‰² */
        .day[data-status="planned"] { background-color: var(--planned-bg); border-color: var(--planned-text); }
        .day[data-status="done"] { background-color: var(--done-bg); border-color: var(--done-text); }
        
        .date-num { font-size: 0.85em; font-weight: bold; color: #444; }
        .class-info { font-size: 0.7em; margin-top: auto; text-align: right; font-weight: 800; }
        
        [data-status="planned"] .class-info { color: var(--planned-text); }
        [data-status="done"] .class-info { color: var(--done-text); }

        .legend { margin-top: 15px; font-size: 0.75em; color: #888; display: flex; gap: 15px; }
        .dot { width: 8px; height: 8px; display: inline-block; border-radius: 50%; margin-right: 4px; }
    </style>
</head>
<body>

    <h3 style="margin: 0 0 15px 0; font-size: 1.2em;">ğŸ’ª å†²åˆº 3.31 (ç¬¬21-36èŠ‚)</h3>

    <div class="stats">
        <div>
            <strong id="done-display" style="color:var(--done-text)">0</strong>
            <span style="color:#888">å·²å®Œæˆ (ç›®æ ‡36)</span>
        </div>
        <div>
            <strong id="remaining-display" style="color:#ff9800">0</strong>
            <span style="color:#888">å‰©ä½™éœ€å®‰æ’</span>
        </div>
    </div>

    <div class="calendar-grid" id="calendar">
        <div class="weekday-header">æ—¥</div><div class="weekday-header">ä¸€</div>
        <div class="weekday-header">äºŒ</div><div class="weekday-header">ä¸‰</div>
        <div class="weekday-header">å››</div><div class="weekday-header">äº”</div>
        <div class="weekday-header">å…­</div>
    </div>

    <div class="legend">
        <span><i class="dot" style="background:var(--done-text)"></i>å·²å®Œæˆ</span>
        <span><i class="dot" style="background:var(--planned-text)"></i>è®¡åˆ’ä¸­</span>
        <span><i class="dot" style="background:var(--today-border)"></i>ä»Šå¤©</span>
    </div>

<script>
    // --- æ ¸å¿ƒé…ç½® ---
    const totalGoal = 36;
    const baseCount = 20; // è¿™é‡Œçš„é€»è¾‘æ˜¯ï¼š1æœˆ15æ—¥ä¹‹å‰å·²ç»é»˜è®¤å®Œæˆäº†20èŠ‚
    const start = new Date(2026, 0, 1); // æ˜¾ç¤ºä»1æœˆ1æ—¥å¼€å§‹
    const end = new Date(2026, 2, 31);  // ç»“æŸäº3æœˆ31æ—¥
    
    // è·å–æœ¬åœ°æ—¶é—´å­—ç¬¦ä¸² YYYY-MM-DD
    function getLocalDateStr(date) {
        let y = date.getFullYear();
        let m = String(date.getMonth() + 1).padStart(2, '0');
        let d = String(date.getDate()).padStart(2, '0');
        return `${y}-${m}-${d}`;
    }

    const todayStr = getLocalDateStr(new Date());
    
    // åˆå§‹åŒ–æ•°æ®ï¼škey=æ—¥æœŸ, value=çŠ¶æ€
    // ä½¿ç”¨ 'gym_v5' ä½œä¸ºæ–°çš„å­˜å‚¨é”®åï¼Œé¿å…å’Œæ—§ç‰ˆæœ¬å†²çª
    let schedule = JSON.parse(localStorage.getItem('gym_v5')) || {};
    
    // é¦–æ¬¡æ‰“å¼€é€»è¾‘ï¼šå¦‚æœæ²¡æœ‰ä»»ä½•è®°å½•ï¼Œé»˜è®¤æŠŠâ€œä»Šå¤©â€è®¾ä¸ºå·²å®Œæˆ
    if (Object.keys(schedule).length === 0) {
        schedule[todayStr] = 'done';
    }

    function render() {
        const container = document.getElementById('calendar');
        // ä¿å­˜å¹¶é‡æ–°æ’å…¥è¡¨å¤´
        const headers = Array.from(container.querySelectorAll('.weekday-header'));
        container.innerHTML = '';
        headers.forEach(h => container.appendChild(h));

        // 1. è®¡ç®—ç¼–å·ï¼šå°†æ‰€æœ‰è¢«æ ‡è®°çš„æ—¥æœŸæŒ‰æ—¶é—´æ’åº
        const sortedDates = Object.keys(schedule).sort();
        const dateToNum = {};
        sortedDates.forEach((d, i) => {
            // ç¬¬å‡ èŠ‚ = åŸºç¡€20èŠ‚ + æ’åºåçš„ç´¢å¼• + 1
            // ä¾‹å¦‚ï¼šåˆ—è¡¨é‡Œç¬¬ä¸€ä¸ªå¦‚æœæ˜¯ä»Šå¤©ï¼Œå°±æ˜¯ 20 + 0 + 1 = 21èŠ‚
            dateToNum[d] = baseCount + i + 1;
        });

        // 2. æ¸²æŸ“æ—¥å†æ ¼å­
        let cur = new Date(start);
        let curMonth = -1;

        while (cur <= end) {
            const dateStr = getLocalDateStr(cur);
            
            // æ’å…¥æœˆä»½åˆ†å‰²æ¡
            if (cur.getMonth() !== curMonth) {
                curMonth = cur.getMonth();
                const div = document.createElement('div');
                div.className = 'month-divider';
                div.innerText = `${cur.getFullYear()}å¹´ ${curMonth + 1}æœˆ`;
                container.appendChild(div);
                // è¡¥é½æœˆåˆç©ºç™½
                for(let i=0; i<cur.getDay(); i++) {
                    const spacer = document.createElement('div');
                    container.appendChild(spacer);
                }
            }

            const dayEl = document.createElement('div');
            dayEl.className = 'day';
            
            // æ ‡è®°ä»Šå¤©
            if (dateStr === todayStr) dayEl.classList.add('today');
            
            // æ ‡è®°çŠ¶æ€
            const status = schedule[dateStr];
            if (status) dayEl.dataset.status = status;

            // æ˜¾ç¤ºå†…å®¹
            const numText = status ? `ç¬¬${dateToNum[dateStr]}èŠ‚` : '';
            dayEl.innerHTML = `
                <div class="date-num">${cur.getDate()}</div>
                <div class="class-info">${numText}</div>
            `;

            // ç‚¹å‡»äº‹ä»¶
            dayEl.onclick = () => {
                if (!status) schedule[dateStr] = 'planned';       // ç©ºç™½ -> è®¡åˆ’
                else if (status === 'planned') schedule[dateStr] = 'done'; // è®¡åˆ’ -> å®Œæˆ
                else delete schedule[dateStr];                    // å®Œæˆ -> åˆ é™¤
                
                localStorage.setItem('gym_v5', JSON.stringify(schedule));
                render();
            };

            container.appendChild(dayEl);
            cur.setDate(cur.getDate() + 1);
        }

        // 3. æ›´æ–°é¡¶éƒ¨ç»Ÿè®¡
        // æ€»å·²å®Œæˆ = åŸºç¡€20 + ç•Œé¢ä¸Šæ ‡ç»¿çš„
        const doneOnScreen = Object.values(schedule).filter(s => s === 'done').length;
        const totalDone = baseCount + doneOnScreen;
        
        // æ€»å·²å®‰æ’ = åŸºç¡€20 + ç•Œé¢ä¸Šæ‰€æœ‰çš„
        const totalScheduled = baseCount + sortedDates.length;
        
        document.getElementById('done-display').innerText = `${totalDone}/${totalGoal}`;
        // å‰©ä½™éœ€å®‰æ’ = 36 - æ€»å·²å®‰æ’
        document.getElementById('remaining-display').innerText = Math.max(0, totalGoal - totalScheduled);
    }

    render();
</script>
</body>
</html>
