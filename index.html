<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¡”ç½—å åœå·¥åŠ </title>
    <style>
        :root {
            --primary-color: #e0c097;
            --bg-gradient: radial-gradient(circle at center, #1a002a 0%, #050008 100%);
            --card-back: repeating-linear-gradient(45deg, #4a2c5a, #4a2c5a 5px, #2a0c3a 5px, #2a0c3a 10px);
        }

        body {
            background: var(--bg-gradient);
            color: var(--primary-color);
            font-family: 'STKaiti', 'Georgia', serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 10px;
        }

        h1 { text-shadow: 0 0 10px rgba(224, 192, 151, 0.5); margin: 15px 0 5px 0; }

        /* å¯¼èˆªåŒº */
        .main-nav, .sub-controls {
            display: flex; gap: 8px; margin-bottom: 15px; flex-wrap: wrap; justify-content: center;
        }

        .nav-btn {
            background: rgba(90, 56, 117, 0.3);
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .nav-btn.active {
            background: var(--primary-color);
            color: #1a002a;
        }

        .action-btn {
            background: linear-gradient(45deg, #5a3875, #8a58a8);
            border: none;
            color: white;
            padding: 10px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            margin-bottom: 15px;
        }

        #status-bar { margin-bottom: 10px; color: #b893cc; height: 20px; font-size: 14px;}

        /* === ç‰Œæ¡ŒåŒºåŸŸ === */
        /* åœ£ä¸‰è§’ç»“æœåŒº */
        .result-container {
            display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; width: 100%;
        }

        /* è‡ªç”±ç¿»ç‰Œ & æ‰‹åŠ¨é€‰ç‰ŒåŒº (ç½‘æ ¼å¸ƒå±€) */
        #deck-grid {
            display: flex; flex-wrap: wrap; justify-content: center; gap: 5px;
            max-width: 600px; margin-bottom: 20px; transition: all 0.3s;
        }

        /* å¡ç‰Œæ ·å¼ */
        .card-slot {
            width: 45px; height: 75px; /* é»˜è®¤å°ç‰ŒèƒŒ */
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
            perspective: 1000px;
        }

        /* è‡ªç”±æ¨¡å¼ä¸‹ç¿»å¼€çš„å¡ç‰Œç¨å¾®å¤§ä¸€ç‚¹ */
        .card-slot.flipped {
            width: 90px; height: 155px;
            margin: 5px;
        }

        .card-inner {
            width: 100%; height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }

        .card-slot.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front, .card-back-face {
            width: 100%; height: 100%;
            position: absolute;
            backface-visibility: hidden;
            border-radius: 5px;
            border: 1px solid #5a3875;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }

        .card-back-face {
            background: var(--card-back);
        }

        .card-front {
            background: #220033;
            transform: rotateY(180deg);
            display: flex; flex-direction: column;
            overflow: hidden;
        }

        .card-front img { width: 100%; height: 100%; object-fit: cover; }
        .reversed img { transform: rotate(180deg); }

        /* åœ£ä¸‰è§’æ¨¡å¼çš„å¤§å¡ç‰Œ */
        .triangle-card {
            display: flex; flex-direction: column; align-items: center;
            animation: fadeIn 0.6s ease forwards; opacity: 0;
        }
        .triangle-img-wrap {
            width: 105px; height: 180px; border: 2px solid var(--primary-color);
            border-radius: 8px; overflow: hidden; background: #220033;
            position: relative; display: flex; align-items: center; justify-content: center;
        }
        .triangle-img-wrap img { width: 100%; height: 100%; object-fit: cover; }

        .label { font-size: 14px; margin-bottom: 5px; color: #b893cc; font-weight: bold;}
        .card-name { 
            position: absolute; bottom: 0; width: 100%; 
            background: rgba(0,0,0,0.7); color: white; 
            font-size: 10px; text-align: center; padding: 2px 0;
        }
        .triangle-card .card-name { position: static; background: none; font-size: 13px; margin-top: 5px;}

        /* YesNo ç»“æœæ ‡ç­¾ */
        .yn-result {
            margin-top: 15px; text-align: center; 
            background: rgba(0,0,0,0.6); padding: 15px; border-radius: 10px;
            border: 1px solid #5a3875; width: 90%; max-width: 300px;
        }
        .yn-big-text { font-size: 24px; font-weight: bold; margin-bottom: 5px; }
        .yn-desc { font-size: 14px; color: #ccc; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <h1>ğŸ”® å¡”ç½—å åœå·¥åŠ</h1>
    
    <div class="main-nav">
        <button class="nav-btn active" id="tab-triangle" onclick="switchTab('triangle')">åœ£ä¸‰è§’</button>
        <button class="nav-btn" id="tab-free" onclick="switchTab('free')">è‡ªç”±æ— ç‰Œé˜µ</button>
        <button class="nav-btn" id="tab-yesno" onclick="switchTab('yesno')">Yes / No</button>
    </div>

    <div id="triangle-controls" class="sub-controls">
        <button onclick="setTriangleMode('random')" id="btn-tri-rnd" class="nav-btn active">éšæœºæŠ½å–</button>
        <button onclick="setTriangleMode('manual')" id="btn-tri-man" class="nav-btn">äº²è‡ªé€‰ç‰Œ</button>
    </div>
    <button id="draw-btn" class="action-btn" onclick="executeTriangleDraw()">å¼€å§‹å åœ</button>

    <div id="status-bar">å‡†å¤‡å°±ç»ª</div>

    <div id="deck-grid"></div>

    <div class="result-container" id="results"></div>

<script>
    // å›¾ç‰‡åŠ é€Ÿ
    const getFastImgUrl = (path) => `https://wsrv.nl/?url=https://upload.wikimedia.org/wikipedia/commons/${path}&w=220&output=webp`;

    // === æ•°æ®å®šä¹‰ ===
    // åŸºç¡€78å¼ ç‰Œæ•°æ®
    const tarotData = [
        {id: 0, name: "0-æ„šè€…", path: "9/90/RWS_Tarot_00_Fool.jpg"},
        {id: 1, name: "I-é­”æœ¯å¸ˆ", path: "d/de/RWS_Tarot_01_Magician.jpg"},
        {id: 2, name: "II-å¥³æ•™çš‡", path: "8/88/RWS_Tarot_02_High_Priestess.jpg"},
        {id: 3, name: "III-çš‡å", path: "d/d2/RWS_Tarot_03_Empress.jpg"},
        {id: 4, name: "IV-çš‡å¸", path: "c/c3/RWS_Tarot_04_Emperor.jpg"},
        {id: 5, name: "V-æ•™çš‡", path: "8/8d/RWS_Tarot_05_Hierophant.jpg"},
        {id: 6, name: "VI-æ‹äºº", path: "a/af/Tarot_VI_The_Lovers.jpg"},
        {id: 7, name: "VII-æˆ˜è½¦", path: "9/9b/RWS_Tarot_07_Chariot.jpg"},
        {id: 8, name: "VIII-åŠ›é‡", path: "f/f5/RWS_Tarot_08_Strength.jpg"},
        {id: 9, name: "IX-éšå£«", path: "4/4d/RWS_Tarot_09_Hermit.jpg"},
        {id: 10, name: "X-å‘½è¿ä¹‹è½®", path: "3/3c/RWS_Tarot_10_Wheel_of_Fortune.jpg"},
        {id: 11, name: "XI-æ­£ä¹‰", path: "e/e0/RWS_Tarot_11_Justice.jpg"},
        {id: 12, name: "XII-å€’åŠäºº", path: "2/2b/RWS_Tarot_12_Hanged_Man.jpg"},
        {id: 13, name: "XIII-æ­»ç¥", path: "d/d7/RWS_Tarot_13_Death.jpg"},
        {id: 14, name: "XIV-èŠ‚åˆ¶", path: "f/f8/RWS_Tarot_14_Temperance.jpg"},
        {id: 15, name: "XV-æ¶é­”", path: "5/55/RWS_Tarot_15_Devil.jpg"},
        {id: 16, name: "XVI-é«˜å¡”", path: "5/53/RWS_Tarot_16_Tower.jpg"},
        {id: 17, name: "XVII-æ˜Ÿæ˜Ÿ", path: "d/db/RWS_Tarot_17_Star.jpg"},
        {id: 18, name: "XVIII-æœˆäº®", path: "7/7f/RWS_Tarot_18_Moon.jpg"},
        {id: 19, name: "XIX-å¤ªé˜³", path: "1/17/RWS_Tarot_19_Sun.jpg"},
        {id: 20, name: "XX-å®¡åˆ¤", path: "d/dd/RWS_Tarot_20_Judgement.jpg"},
        {id: 21, name: "XXI-ä¸–ç•Œ", path: "f/ff/RWS_Tarot_21_World.jpg"},
        // å°é˜¿å¡çº³
        {id: 22, name: "æƒæ–ä¸€", path: "1/11/Wands01.jpg"}, {id: 23, name: "æƒæ–äºŒ", path: "0/0f/Wands02.jpg"},
        {id: 24, name: "æƒæ–ä¸‰", path: "f/ff/Wands03.jpg"}, {id: 25, name: "æƒæ–å››", path: "a/a4/Wands04.jpg"},
        {id: 26, name: "æƒæ–äº”", path: "9/9d/Wands05.jpg"}, {id: 27, name: "æƒæ–å…­", path: "3/3b/Wands06.jpg"},
        {id: 28, name: "æƒæ–ä¸ƒ", path: "e/e4/Wands07.jpg"}, {id: 29, name: "æƒæ–å…«", path: "6/6b/Wands08.jpg"},
        {id: 30, name: "æƒæ–ä¹", path: "e/e3/Wands09.jpg"}, {id: 31, name: "æƒæ–å", path: "0/0b/Wands10.jpg"},
        {id: 32, name: "æƒæ–ä¾ä»", path: "6/6a/WandsPage.jpg"}, {id: 33, name: "æƒæ–éª‘å£«", path: "1/16/WandsKnight.jpg"},
        {id: 34, name: "æƒæ–ç‹å", path: "0/0d/WandsQueen.jpg"}, {id: 35, name: "æƒæ–å›½ç‹", path: "c/ce/WandsKing.jpg"},
        {id: 36, name: "åœ£æ¯ä¸€", path: "3/36/Cups01.jpg"}, {id: 37, name: "åœ£æ¯äºŒ", path: "f/f8/Cups02.jpg"},
        {id: 38, name: "åœ£æ¯ä¸‰", path: "7/7a/Cups03.jpg"}, {id: 39, name: "åœ£æ¯å››", path: "3/35/Cups04.jpg"},
        {id: 40, name: "åœ£æ¯äº”", path: "d/d7/Cups05.jpg"}, {id: 41, name: "åœ£æ¯å…­", path: "1/17/Cups06.jpg"},
        {id: 42, name: "åœ£æ¯ä¸ƒ", path: "a/ae/Cups07.jpg"}, {id: 43, name: "åœ£æ¯å…«", path: "6/60/Cups08.jpg"},
        {id: 44, name: "åœ£æ¯ä¹", path: "2/24/Cups09.jpg"}, {id: 45, name: "åœ£æ¯å", path: "8/84/Cups10.jpg"},
        {id: 46, name: "åœ£æ¯ä¾ä»", path: "a/a6/CupsPage.jpg"}, {id: 47, name: "åœ£æ¯éª‘å£«", path: "f/fa/CupsKnight.jpg"},
        {id: 48, name: "åœ£æ¯ç‹å", path: "6/61/CupsQueen.jpg"}, {id: 49, name: "åœ£æ¯å›½ç‹", path: "f/f0/CupsKing.jpg"},
        {id: 50, name: "å®å‰‘ä¸€", path: "1/1a/Swords01.jpg"}, {id: 51, name: "å®å‰‘äºŒ", path: "9/92/Swords02.jpg"},
        {id: 52, name: "å®å‰‘ä¸‰", path: "2/2c/Swords03.jpg"}, {id: 53, name: "å®å‰‘å››", path: "b/bf/Swords04.jpg"},
        {id: 54, name: "å®å‰‘äº”", path: "2/23/Swords05.jpg"}, {id: 55, name: "å®å‰‘å…­", path: "2/29/Swords06.jpg"},
        {id: 56, name: "å®å‰‘ä¸ƒ", path: "3/34/Swords07.jpg"}, {id: 57, name: "å®å‰‘å…«", path: "a/a7/Swords08.jpg"},
        {id: 58, name: "å®å‰‘ä¹", path: "2/2f/Swords09.jpg"}, {id: 59, name: "å®å‰‘å", path: "d/d4/Swords10.jpg"},
        {id: 60, name: "å®å‰‘ä¾ä»", path: "4/4c/SwordsPage.jpg"}, {id: 61, name: "å®å‰‘éª‘å£«", path: "b/b0/SwordsKnight.jpg"},
        {id: 62, name: "å®å‰‘ç‹å", path: "d/d4/SwordsQueen.jpg"}, {id: 63, name: "å®å‰‘å›½ç‹", path: "3/33/SwordsKing.jpg"},
        {id: 64, name: "æ˜Ÿå¸ä¸€", path: "f/fd/Pents01.jpg"}, {id: 65, name: "æ˜Ÿå¸äºŒ", path: "9/9f/Pents02.jpg"},
        {id: 66, name: "æ˜Ÿå¸ä¸‰", path: "4/42/Pents03.jpg"}, {id: 67, name: "æ˜Ÿå¸å››", path: "3/35/Pents04.jpg"},
        {id: 68, name: "æ˜Ÿå¸äº”", path: "9/96/Pents05.jpg"}, {id: 69, name: "æ˜Ÿå¸å…­", path: "a/a6/Pents06.jpg"},
        {id: 70, name: "æ˜Ÿå¸ä¸ƒ", path: "6/6a/Pents07.jpg"}, {id: 71, name: "æ˜Ÿå¸å…«", path: "4/49/Pents08.jpg"},
        {id: 72, name: "æ˜Ÿå¸ä¹", path: "f/f0/Pents09.jpg"}, {id: 73, name: "æ˜Ÿå¸å", path: "4/42/Pents10.jpg"},
        {id: 74, name: "æ˜Ÿå¸ä¾ä»", path: "e/e0/PentsPage.jpg"}, {id: 75, name: "æ˜Ÿå¸éª‘å£«", path: "c/c6/PentsKnight.jpg"},
        {id: 76, name: "æ˜Ÿå¸ç‹å", path: "8/88/PentsQueen.jpg"}, {id: 77, name: "æ˜Ÿå¸å›½ç‹", path: "1/14/PentsKing.jpg"}
    ];

    // === Yes/No è§„åˆ™é…ç½® (å…±27å¼ ) ===
    // 0-21: å¤§é˜¿å¡çº³, 22:æƒæ–1, 36:åœ£æ¯1, 50:å®å‰‘1, 64:æ˜Ÿå¸1, 44:åœ£æ¯9
    const yesNoDeckIds = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21, 22,36,50,64, 44];
    
    // è§„åˆ™æ˜ å°„
    const ynRules = {
        // ç­‰å¾… (Aces)
        22: {type: 'WAIT', text: 'ç­‰å¾…æ—¶é—´çš„å®‰æ’'}, 
        36: {type: 'WAIT', text: 'ç­‰å¾…æ—¶é—´çš„å®‰æ’'}, 
        50: {type: 'WAIT', text: 'ç­‰å¾…æ—¶é—´çš„å®‰æ’'}, 
        64: {type: 'WAIT', text: 'ç­‰å¾…æ—¶é—´çš„å®‰æ’'},
        
        // æ˜ç¡®çš„æ˜¯
        44: {type: 'YES', text: 'æ˜ç¡®çš„ â€œæ˜¯â€'}, // åœ£æ¯ä¹
        0: {type: 'YES', text: 'æ˜ç¡®çš„ â€œæ˜¯â€'}, // æ„šè€…
        1: {type: 'YES', text: 'æ˜ç¡®çš„ â€œæ˜¯â€'}, // é­”æœ¯å¸ˆ
        3: {type: 'YES', text: 'æ˜ç¡®çš„ â€œæ˜¯â€'}, // çš‡å
        4: {type: 'YES', text: 'æ˜ç¡®çš„ â€œæ˜¯â€'}, // çš‡å¸
        7: {type: 'YES', text: 'æ˜ç¡®çš„ â€œæ˜¯â€'}, // æˆ˜è½¦
        11: {type: 'YES', text: 'æ˜ç¡®çš„ â€œæ˜¯â€'}, // æ­£ä¹‰
        17: {type: 'YES', text: 'æ˜ç¡®çš„ â€œæ˜¯â€'}, // æ˜Ÿæ˜Ÿ
        19: {type: 'YES', text: 'æ˜ç¡®çš„ â€œæ˜¯â€'}, // å¤ªé˜³
        21: {type: 'YES', text: 'æ˜ç¡®çš„ â€œæ˜¯â€'}, // ä¸–ç•Œ

        // æ˜ç¡®çš„å¦
        8: {type: 'NO', text: 'æ˜ç¡®çš„ â€œå¦â€'}, // åŠ›é‡
        16: {type: 'NO', text: 'æ˜ç¡®çš„ â€œå¦â€'}, // é«˜å¡”
        14: {type: 'NO', text: 'æ˜ç¡®çš„ â€œå¦â€'}, // èŠ‚åˆ¶
        9: {type: 'NO', text: 'æ˜ç¡®çš„ â€œå¦â€'}, // éšå£«
        12: {type: 'NO', text: 'æ˜ç¡®çš„ â€œå¦â€'}, // å€’åŠäºº
        13: {type: 'NO', text: 'æ˜ç¡®çš„ â€œå¦â€'}, // æ­»ç¥
        15: {type: 'NO', text: 'æ˜ç¡®çš„ â€œå¦â€'}, // æ¶é­”

        // ç›´è§‰è§£ç­” (å‰©ä¸‹çš„)
        2: {type: 'OPEN', text: 'ä¸åˆ†æ˜¯å¦ï¼Œä¾ç›´è§‰è§£ç­”'}, 
        10: {type: 'OPEN', text: 'ä¸åˆ†æ˜¯å¦ï¼Œä¾ç›´è§‰è§£ç­”'},
        6: {type: 'OPEN', text: 'ä¸åˆ†æ˜¯å¦ï¼Œä¾ç›´è§‰è§£ç­”'},
        5: {type: 'OPEN', text: 'ä¸åˆ†æ˜¯å¦ï¼Œä¾ç›´è§‰è§£ç­”'},
        18: {type: 'OPEN', text: 'ä¸åˆ†æ˜¯å¦ï¼Œä¾ç›´è§‰è§£ç­”'},
        20: {type: 'OPEN', text: 'ä¸åˆ†æ˜¯å¦ï¼Œä¾ç›´è§‰è§£ç­”'}
    };

    // === å…¨å±€çŠ¶æ€ ===
    let currentTab = 'triangle';
    let triangleMode = 'random'; // random / manual
    let manualChoices = []; // åœ£ä¸‰è§’æ‰‹åŠ¨é€‰ç‰Œç”¨
    let shuffledIndices = []; // å­˜æ”¾å½“å‰æ´—å¥½çš„ç‰Œåº

    // åˆå§‹åŒ–
    function init() {
        switchTab('triangle');
    }

    // === å¯¼èˆªåˆ‡æ¢ ===
    function switchTab(tab) {
        currentTab = tab;
        
        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        document.querySelectorAll('.main-nav .nav-btn').forEach(b => {
            if (b.id.startsWith('tab-')) b.classList.remove('active');
        });
        document.getElementById(`tab-${tab}`).classList.add('active');

        // æ¸…ç†ç•Œé¢
        document.getElementById('deck-grid').innerHTML = '';
        document.getElementById('results').innerHTML = '';
        document.getElementById('triangle-controls').style.display = 'none';
        document.getElementById('draw-btn').style.display = 'none';

        // æ¨¡å¼åˆå§‹åŒ–
        if (tab === 'triangle') {
            document.getElementById('triangle-controls').style.display = 'flex';
            document.getElementById('draw-btn').style.display = 'inline-block';
            setTriangleMode('random');
        } 
        else if (tab === 'free') {
            initFreeMode();
        }
        else if (tab === 'yesno') {
            initYesNoMode();
        }
    }

    // === åŠŸèƒ½ä¸€ï¼šåœ£ä¸‰è§’é€»è¾‘ ===
    function setTriangleMode(mode) {
        triangleMode = mode;
        document.getElementById('btn-tri-rnd').classList.toggle('active', mode === 'random');
        document.getElementById('btn-tri-man').classList.toggle('active', mode === 'manual');
        
        const btn = document.getElementById('draw-btn');
        const deck = document.getElementById('deck-grid');
        const status = document.getElementById('status-bar');

        document.getElementById('results').innerHTML = '';

        if (mode === 'random') {
            btn.style.display = 'inline-block';
            deck.style.display = 'none';
            status.innerText = 'ç‚¹å‡»æŒ‰é’®éšæœºæŠ½å– 3 å¼ ';
        } else {
            btn.style.display = 'none';
            deck.style.display = 'flex';
            status.innerText = 'è¯·ä»ä¸‹æ–¹é€‰å– 3 å¼ ç‰Œ...';
            renderBackDeck(78, (idx) => manualPickTriangle(idx));
            manualChoices = [];
            shuffledIndices = shuffle(Array.from({length: 78}, (_, i) => i));
        }
    }

    function executeTriangleDraw() {
        // éšæœºæ¨¡å¼ç›´æ¥æŠ½
        const indices = shuffle(Array.from({length: 78}, (_, i) => i)).slice(0, 3);
        renderTriangleResult(indices);
    }

    function manualPickTriangle(uiIdx) {
        if (manualChoices.length >= 3) return;
        
        // è§†è§‰é€‰ä¸­
        const cards = document.querySelectorAll('.card-slot');
        if (cards[uiIdx].style.visibility === 'hidden') return;
        cards[uiIdx].style.visibility = 'hidden';

        // è®°å½•é€»è¾‘é€‰ä¸­
        manualChoices.push(shuffledIndices[uiIdx]);
        document.getElementById('status-bar').innerText = `å·²é€‰ ${manualChoices.length} / 3`;

        if (manualChoices.length === 3) {
            document.getElementById('deck-grid').style.display = 'none'; // é€‰å®Œéšè—ç‰Œå †
            renderTriangleResult(manualChoices);
        }
    }

    function renderTriangleResult(indices) {
        const container = document.getElementById('results');
        container.innerHTML = '';
        document.getElementById('status-bar').innerText = 'è¿‡å» Â· ç°åœ¨ Â· æœªæ¥';

        indices.forEach((idx, i) => {
            const data = tarotData[idx];
            const isRev = Math.random() > 0.5;
            const labels = ['Past / è¿‡å»', 'Present / ç°åœ¨', 'Future / æœªæ¥'];
            
            const div = document.createElement('div');
            div.className = 'triangle-card';
            div.style.animationDelay = `${i * 0.2}s`;
            div.innerHTML = `
                <div class="label">${labels[i]}</div>
                <div class="triangle-img-wrap ${isRev ? 'reversed' : ''}">
                    <img src="${getFastImgUrl(data.path)}">
                    <div class="card-name">${data.name} ${isRev ? '(é€†)' : ''}</div>
                </div>
            `;
            container.appendChild(div);
        });
    }

    // === åŠŸèƒ½äºŒï¼šè‡ªç”±æ— ç‰Œé˜µ (åŸåœ°ç¿»ç‰Œ) ===
    function initFreeMode() {
        document.getElementById('status-bar').innerText = 'è‡ªç”±ç‰Œæ¡Œï¼šç‚¹å‡»ä»»æ„ç‰ŒèƒŒå³å¯ç¿»å¼€';
        document.getElementById('deck-grid').style.display = 'flex';
        
        // æ¸²æŸ“78å¼ ç‰Œï¼Œç‚¹å‡»ç›´æ¥åŸåœ°ç¿»å¼€
        // å…ˆæ´—ç‰Œï¼ŒæŠŠ ID æ˜ å°„åˆ° UI ä½ç½®ä¸Š
        shuffledIndices = shuffle(Array.from({length: 78}, (_, i) => i));
        renderBackDeck(78, (uiIdx, slot) => flipCardInPlace(uiIdx, slot, shuffledIndices));
    }

    function flipCardInPlace(uiIdx, slotElement, indexMap) {
        if (slotElement.classList.contains('flipped')) return;

        const realCardIdx = indexMap[uiIdx];
        const data = tarotData[realCardIdx];
        const isRev = Math.random() > 0.5;

        // æ³¨å…¥æ­£é¢ HTML
        const frontDiv = slotElement.querySelector('.card-front');
        frontDiv.innerHTML = `
            <img src="${getFastImgUrl(data.path)}" class="${isRev ? 'reversed' : ''}">
            <div class="card-name">${data.name} ${isRev ? '(é€†)' : ''}</div>
        `;

        slotElement.classList.add('flipped');
    }

    // === åŠŸèƒ½ä¸‰ï¼šYes/No å®šåˆ¶ç‰ˆ ===
    function initYesNoMode() {
        document.getElementById('status-bar').innerText = 'Yes/No æŠ‰æ‹©ï¼šè¯·å‡­ç›´è§‰ç‚¹å‡»ä¸€å¼  (å…±27å¼ )';
        document.getElementById('deck-grid').style.display = 'flex';
        
        // å‡†å¤‡ 27 å¼ ç‰Œçš„ç´¢å¼•
        const deck27 = [...yesNoDeckIds];
        shuffledIndices = shuffle(deck27);

        renderBackDeck(27, (uiIdx) => pickYesNo(uiIdx));
    }

    function pickYesNo(uiIdx) {
        // é€‰ä¸­ä¸€å¼ åï¼Œæ¸…ç†æ¡Œé¢ï¼Œæ˜¾ç¤ºç»“æœ
        const realId = shuffledIndices[uiIdx];
        const data = tarotData[realId];
        const rule = ynRules[realId];
        
        // æ¸…ç©ºç‰Œæ¡Œ
        document.getElementById('deck-grid').innerHTML = '';
        
        // æ˜¾ç¤ºå¤§å›¾å’Œç»“æœ
        const container = document.getElementById('results');
        
        // é¢œè‰²åˆ¤å®š
        let color = '#ccc';
        if(rule.type === 'YES') color = '#4caf50';
        if(rule.type === 'NO') color = '#f44336';
        if(rule.type === 'WAIT') color = '#ff9800';
        if(rule.type === 'OPEN') color = '#9c27b0';

        container.innerHTML = `
            <div class="triangle-card" style="opacity:1">
                <div class="triangle-img-wrap">
                    <img src="${getFastImgUrl(data.path)}">
                </div>
                <div class="label" style="margin-top:10px">${data.name}</div>
            </div>
            <div class="yn-result" style="border-color:${color}">
                <div class="yn-big-text" style="color:${color}">${rule.type === 'WAIT' || rule.type === 'OPEN' ? 'Hint' : rule.type}</div>
                <div class="yn-desc">${rule.text}</div>
            </div>
            <button class="nav-btn" style="margin-top:20px" onclick="initYesNoMode()">å†æŠ½ä¸€æ¬¡</button>
        `;
        document.getElementById('status-bar').innerText = 'è§£è¯»å®Œæˆ';
    }


    // === é€šç”¨å·¥å…· ===
    // æ¸²æŸ“ç‰ŒèƒŒç½‘æ ¼
    function renderBackDeck(count, clickHandler) {
        const deck = document.getElementById('deck-grid');
        deck.innerHTML = '';
        for (let i = 0; i < count; i++) {
            const slot = document.createElement('div');
            slot.className = 'card-slot';
            slot.innerHTML = `
                <div class="card-inner">
                    <div class="card-back-face"></div>
                    <div class="card-front"></div>
                </div>
            `;
            // ç»‘å®šç‚¹å‡»
            slot.onclick = () => clickHandler(i, slot);
            deck.appendChild(slot);
        }
    }

    // æ´—ç‰Œç®—æ³•
    function shuffle(array) {
        let currentIndex = array.length, randomIndex;
        while (currentIndex != 0) {
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;
            [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
        }
        return array;
    }

    window.onload = init;
</script>
</body>
</html>
